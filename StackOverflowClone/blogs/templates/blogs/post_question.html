{% extends 'home/common.html' %}
{% load static %}
{% block body_content %}
{% load crispy_forms_tags %}

<!--Register--> 
<style>
	#id_body{
		line-height: 1.5rem !important;
	}
	#div_id_body{
		margin-bottom: 10px;
		margin-top: 10px;
	}
	.django-ckeditor-widget{
		width: 100%;
	}
	#cke_id_body{
		width: auto !important;
	}


</style>
<script type="text/javascript" src="{% static 'ckeditor/ckeditor-init.js' %}"></script>
<script type="text/javascript" src="{% static 'ckeditor/ckeditor/ckeditor.js' %}"></script>
<div class="container py-5">
	<div class="row" style="justify-content: space-between;">
        <h4 class="main_title col-sm-10" style="width: auto;">Ask a Question:</h4>
		{% if question_id == 0 %}
        <a href="{% url 'index' %}" class="btn btn-primary center" style="width:auto;">Back</a>
		{% else %}
		<a href="{% url 'view_question' question_id %}" class="btn btn-primary center" style="width:auto;">Back</a>
		{% endif %}
    </div>
    
    <form id="question_form" method="POST" action="{% url 'post_question' question_id %}">
		{% csrf_token %}
		{{ form|crispy }}  

		<label>Tags*</label>
		<br>
		<div style="width: 100%;">
			<input type="text" placeholder="use , between two tags" id="search_tag" name="search_tag" class="textinput form-control">   
		</div>
		<br>
		<br>               
		<button name="publish_button" class="btn btn-primary" type="submit">Post</button>
		<button name="draft_button" class="btn btn-primary" type="submit">Save as a Draft</button>
		
	</form>
</div>
<script>
	var tag_response = {{ tags|safe }},
	tag_ms = $("#search_tag").magicSuggest({
		allowFreeEntries: false,
	});
	tag_ms.setSelection(tag_response)
    $(tag_ms).on('keyup', function(e, m, v){
        var input_tags = v.target.value;
		if(input_tags.length > 0){
			var csrfmiddlewaretoken = '{{ csrf_token }}'
			var postData = {
				"input_tags": input_tags,
				"csrfmiddlewaretoken": csrfmiddlewaretoken,
			}
			$.ajax({
				dataType: "json",
				type: "POST",
				url: "/blogs/search_tags/",
				data: postData,
				success: function (data) {
					tag_ms.setData(data.data);
				}
			})
		}
	})

	var question_socket = new WebSocket("ws://" + window.location.host + "/ws/question/" + '{{ question_id }}' + '/');
        question_socket.onopen = function (e) {
            console.log("Successfully connected to the question_socket.",question_socket);
        }
        $('#question_form').submit(function(){
            question_socket.send(JSON.stringify({
                'message': 'Question has been edited',
				"user_id": '{{ request.user.id }}',
            }));

        })

</script>

{% endblock %}
